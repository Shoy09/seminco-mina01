<!-- Contenedor de pestañas y formulario -->
<div class="form-container">
  <!-- Pestañas -->
  <div class="tabs">
    <button class="tab-btn" [class.active]="formularioActivo === 'botones'" (click)="mostrarFormulario('botones')">
      Crear nueva data <img src="mas.svg" class="side-image" />
    </button>
    <button class="tab-btn" [class.active]="formularioActivo === 'documento'" (click)="mostrarFormulario('documento')">
      Carga de datos <img src="archivo.svg" class="side-image" />
    </button>
  </div>

  <!-- Formulario de botones -->
  <div *ngIf="formularioActivo === 'botones'" class="ventana">
    <div class="button-container-wrapper">
      <div class="button-container" *ngFor="let button of buttonc" (click)="abrirModal(button)">
        <p class="button-nombre">{{ button.nombre }}</p>
        <img [src]="button.icon" alt="Ícono" class="button-icon">
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="modalAbierto">
    <div class="modal">
      <button class="close-icon" (click)="cerrarModal()">✖</button>

      <div class="modal-content">
        <div class="subtitu">
          <h2>{{ modalContenido?.nombre }}</h2>
          <p>{{ editando ? 'Editando ' : 'Creación del tipo de ' }}{{ modalContenido?.nombre }}</p>
        </div>

        <!-- FORMULARIO DEL MODAL -->
        <form (submit)="editando ? actualizarDatos() : guardarDatos()" class="forme">
          <div class="form-group" *ngFor="let campo of modalContenido?.campos">
            <label>{{ campo.label }}</label>
            <div class="input-container">
              
              <!-- Si es SELECT -->
              <ng-container *ngIf="campo.tipo === 'select'; else inputField">
                <select 
                  [(ngModel)]="nuevoDato[campo.nombre]" 
                  [name]="campo.nombre" 
                  required 
                  class="form-input"
                  (change)="onCampoChange(campo.nombre)">
                  <option *ngFor="let opcion of campo.opciones" [value]="opcion">{{ opcion }}</option>
                </select>
              </ng-container>

              <!-- Si es INPUT -->
              <ng-template #inputField>
                <input 
                  [type]="campo.tipo" 
                  [(ngModel)]="nuevoDato[campo.nombre]" 
                  [name]="campo.nombre" 
                  required 
                  class="form-input">
              </ng-template>
            </div>
          </div>

          <!-- BOTONES DEL FORMULARIO -->
          <div class="button-group">
            <ng-container *ngIf="!editando; else editButtons">
              <button type="submit" class="btn-submit">Guardar</button>
              <button type="button" class="btn-submit" (click)="triggerFileInput()">
                Importar Excel <img src="excel.png" class="side-image" />
              </button>
              <input type="file" id="fileInput" style="display: none;" 
                     (change)="procesarArchivoExcel($event)" accept=".xlsx, .xls" />
            </ng-container>

            <ng-template #editButtons>
              <button type="submit" class="btn-submit">Actualizar</button>
              <button type="button" class="btn-submit" (click)="cancelarEdicion()">Cancelar</button>
            </ng-template>
          </div>
        </form>

        <!-- BARRA DE BÚSQUEDA -->
<div class="search-container">
  <div class="search-group">
    <input 
      type="text" 
      [(ngModel)]="filtroLabor" 
      (input)="aplicarFiltros()"
      placeholder="Buscar por labor..." 
      class="search-input">
  </div>
  
  <div class="search-group">
    <input 
      type="date" 
      [(ngModel)]="filtroFecha" 
      (change)="aplicarFiltros()"
      class="search-input">
  </div>
  
  <div class="search-group">
    <button 
      type="button" 
      (click)="limpiarFiltros()" 
      class="btn-clear">
      Limpiar filtros
    </button>
  </div>
</div>

<!-- TABLA DENTRO DEL MODAL -->
<div class="tabla-scroll">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th *ngFor="let campo of modalContenido?.campos">{{ campo.label }}</th>
        <th>Opciones</th>
      </tr>
    </thead>
    <tbody>
      <!-- Cambiar esta línea para usar datosFiltrados en lugar de modalContenido?.datos -->
      <tr *ngFor="let dato of datosFiltrados; let i = index">
        <td>{{ i + 1 }}</td>
        <td *ngFor="let campo of modalContenido?.campos">{{ dato[campo.nombre] }}</td>
        <td>
          <img src="boton-editar.png" alt="Editar" class="action-icon" (click)="editarDato(dato, i)">
          <img src="dele.svg" alt="Eliminar" class="action-icon" (click)="eliminar(dato)">
        </td>
      </tr>
    </tbody>
  </table>
  
  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="datosFiltrados.length === 0" class="no-results">
    No se encontraron resultados para los filtros aplicados.
  </div>
</div>
      </div>
    </div>
  </div>

  <!-- Formulario de carga de documento -->
  <div *ngIf="formularioActivo === 'documento'" class="ventana">
    <form class="custom-form">
      <div class="form-row">
        <div class="form-groupu">
          <label for="year" class="titu">Año</label>
          <select id="year">
            <option selected>Seleccione un año</option>
            <option *ngFor="let year of years">{{ year }}</option>
          </select>
        </div>

        <div class="form-groupu">
          <label for="month" class="titu">Mes</label>
          <select id="month">
            <option selected>Seleccione un mes</option>
            <option *ngFor="let mes of meses">{{ mes }}</option>
          </select>
        </div>

        <div class="form-groupu">
          <label for="fileUpload" class="titu">Documento</label>
          <div class="file-upload">
            <label for="fileUpload" class="btn-upload">Subir documento</label>
            <input type="file" id="fileUpload" hidden>
            <input type="text" class="file-name" placeholder="Seleccione un archivo" readonly>
          </div>
        </div>
      </div>
      <button type="submit" class="btn-submit">
        Carga de datos <img src="folder.svg" class="side-image" />
      </button>
    </form>
  </div>
</div>
