<!-- Iteramos directamente por zonas -->
<ng-container *ngFor="let zona of zonasAgrupadas">

  <!-- TÃ­tulo de la zona + opcional colapsar -->
  <div class="zona-header-linea" (click)="toggleExpand(zona.nombre)">
    <h3 class="zona-titulo">{{ zona.nombre }}</h3>
    <span class="zona-toggle">
      {{ expandido[zona.nombre] ? 'âˆ’' : '+' }}
    </span>
  </div>

  <div *ngIf="expandido[zona.nombre]">

    <!-- ðŸ”¹ Cards por labor -->
    <div *ngFor="let labor of zona.labores" class="labor-card">

      <!-- Leyenda / cuadrado izquierdo -->
      <div class="labor-leyenda">
  <div class="leyenda-cuadro"
       [style.background]="labor.color || '#bdbdbd'"
       (mouseenter)="mostrarTooltip($event, labor)"
       (mousemove)="mostrarTooltip($event, labor)"
       (mouseleave)="ocultarTooltip()">

    <span class="leyenda-texto">
      {{ labor.labor }}
    </span>

  </div>
</div>


      <!-- Barra y medidas a la derecha -->
      <div class="labor-detalle">
        <div class="barra-programado">
          <div class="barra-ejecutado"
               [style.width.%]="getPorcentaje(labor.real, labor.programado)">
          </div>
        </div>

        <div class="labor-medidas">
          <span>{{ labor.real }} m</span>
          <span>{{ labor.programado }} m</span>
        </div>
      </div>

    </div>


    <hr class="separador-zona" />

  </div>
</ng-container>

<app-tooltip-labor
  *ngIf="tooltipVisible"
  [labor]="tooltipLabor"
  [x]="tooltipX"
  [y]="tooltipY">
</app-tooltip-labor>